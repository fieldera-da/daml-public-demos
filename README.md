# Daml Public Demos of Daml Shell and Daml Export by Andrew Fielder

Purpose is the highlight the usefulness of Daml Shell and Daml Export for investigation of issues resulting from complex application state.

The export reads the transactions stream between the offsets supplied but the autogenerated daml script only creates the contracts represnting the final outcome of that transaction stream.

## Demo Steps

### Deploy ledger and initailise with contracts

Checkout the demo:

```
git clone https://github.com/wallacekelly-da/daml-public-demos.git --branch pqs-simple-docker-compose --single-branch pqs-simple-docker-compose
```

Get the required images:

```
docker login digitalasset-docker.jfrog.io
docker compose pull
```

Stop local postgres if it is running [It is on Andrew's machine]
```
sudo systemctl stop postgresql
```

Run the demo:

```
daml build
--docker compose up participant1 --detach
docker compose up scripts
```

See that the contracts are created:
```
docker compose up pqs1_scribe --detach
docker compose run --rm daml_shell
```

### Export contracts

Run Daml export:
```
daml ledger export script --host localhost --port 5003 --output export --sdk-version 2.8.3 --all-parties
```

### Bring up clean ledger and import pre-existing contracts

Restart ledger 
```
docker compose down
docker compose up participant1 --detach
```

Update participant id of the partyIds in second colomn of ./export/args.json.
```
daml ledger list-parties --host localhost --port 5003
nano -w ./export/args.json
```

Load contracts using export daml:
```
daml build --project-root ./export/
daml script --ledger-host localhost --ledger-port 5003 --dar ./export/.daml/dist/export-1.0.0.dar --script-name Export:export --input-file ./export/args.json
```

Prove contracts were loaded:
```
docker compose up pqs1_scribe --detach
docker compose run --rm daml_shell
```

### Cleanup

Shutdown system:
```
docker compose down
```

### Navigator alternative [deprecated]
but still useful for demos
```
daml navigator server localhost 5003 --feature-user-management false
```